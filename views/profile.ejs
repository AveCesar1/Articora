<%- include('partials/header', { title: 'Perfil - Artícora', currentPage: 'profile', cssFile: 'profile.css' }) %>

<div class="container py-5">
    <!-- Tarjeta principal del perfil -->
    <div class="card profile-header-card shadow-lg mb-5">
        <div class="card-body">
            <div class="row align-items-center">
                <!-- Columna izquierda: Avatar y datos básicos -->
                <div class="col-md-4 text-center mb-4 mb-md-0">
                    <img src="https://placehold.co/200x200/2c1810/e0d6c2?text=<%= user.fullName.charAt(0) %>" 
                         alt="Foto de perfil" class="profile-avatar mb-4">
                    
                    <h2 class="profile-name mb-2"><%= user.fullName %></h2>
                    <p class="text-muted mb-2">@<%= user.username %></p>
                    
                    <span class="status-badge validated mb-3">
                        <i class="fas fa-check-circle me-1"></i> <%= user.academicStatus %>
                    </span>
                    
                    <div class="mt-3">
                        <a href="/profile/config" class="btn btn-primary">
                            <i class="fas fa-edit me-2"></i> Editar perfil
                        </a>
                    </div>
                </div>
                
                <!-- Columna derecha: Información detallada -->
                <div class="col-md-8">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5 class="section-title mb-3">
                                <i class="fas fa-graduation-cap me-2"></i>Información académica
                            </h5>
                            <div class="info-item mb-2">
                                <strong>Grado:</strong> <%= user.academicDegree %>
                            </div>
                            <div class="info-item mb-2">
                                <strong>Institución:</strong> <%= user.institution %>
                            </div>
                            <div class="info-item mb-2">
                                <strong>Correo:</strong> <%= user.email %>
                            </div>
                            <div class="info-item mb-2">
                                <strong>Miembro desde:</strong> <%= user.joinDate %>
                            </div>
                            <div class="info-item">
                                <strong>Disponible para mensajes:</strong>
                                <% if (user.availableForMessages) { %>
                                    <span class="text-success">Sí</span>
                                <% } else { %>
                                    <span class="text-danger">No</span>
                                <% } %>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h5 class="section-title mb-3">
                                <i class="fas fa-chart-bar me-2"></i>Estadísticas
                            </h5>
                            <div class="profile-stats">
                                <div class="stat">
                                    <span class="stat-value"><%= user.stats.sourcesAdded %></span>
                                    <span class="stat-label">Fuentes subidas</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-value"><%= user.stats.reviewsWritten %></span>
                                    <span class="stat-label">Reseñas escritas</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-value"><%= user.stats.readingLists %></span>
                                    <span class="stat-label">Listas creadas</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-value"><%= user.stats.collaborations %></span>
                                    <span class="stat-label">Colaboraciones</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Biografía -->
                    <div class="mb-4">
                        <h5 class="section-title mb-3">
                            <i class="fas fa-book-open me-2"></i>Biografía
                        </h5>
                        <div class="profile-bio p-3 border-left-accent">
                            <%= user.bio %>
                        </div>
                    </div>
                    
                    <!-- Intereses -->
                    <div>
                        <h5 class="section-title mb-3">
                            <i class="fas fa-tags me-2"></i>Intereses de investigación
                        </h5>
                        <div class="interests-container">
                            <% user.interests.forEach(interest => { %>
                                <span class="category-badge">
                                    <i class="fas fa-hashtag me-1"></i><%= interest %>
                                </span>
                            <% }) %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Segunda fila: Gráfica de radar y actividad -->
    <div class="row">
        <!-- Columna izquierda: Actividad reciente -->
        <div class="col-lg-8 mb-4">
            <div class="card shadow h-100">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-history me-2"></i>Actividad reciente
                    </h5>
                </div>
                <div class="card-body">
                    <div class="activity-list">
                        <% user.recentActivity.forEach(activity => { %>
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="<%= activity.icon %>"></i>
                                </div>
                                <div class="activity-content">
                                    <h6 class="activity-title"><%= activity.title %></h6>
                                    <p class="activity-description"><%= activity.description %></p>
                                    <span class="activity-time">
                                        <i class="far fa-clock me-1"></i><%= activity.time %>
                                    </span>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Columna derecha: Gráfica de radar -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow h-100">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-radar me-2"></i>Distribución de lecturas
                    </h5>
                </div>
                <div class="card-body">
                    <div class="radar-container">
                        <canvas id="readingRadarChart" height="300"></canvas>
                    </div>
                    <div class="text-center mt-3">
                        <p class="text-muted small mb-0">
                            <i class="fas fa-info-circle me-1"></i>
                            Gráfico de radar basado en lecturas registradas
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tercera fila: Listas curatoriales -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-list-ul me-2"></i>Listas curatoriales
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="card list-card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <h6 class="card-title mb-0">Fundamentos de NLP</h6>
                                        <span class="badge bg-primary">12 fuentes</span>
                                    </div>
                                    <p class="card-text small">
                                        Recopilación de los papers más importantes en Procesamiento de Lenguaje Natural.
                                    </p>
                                    <div class="mt-3">
                                        <span class="badge bg-light text-dark me-1">Computacionales</span>
                                        <span class="badge bg-light text-dark">IA</span>
                                    </div>
                                </div>
                                <div class="card-footer bg-transparent border-top-0">
                                    <small class="text-muted">
                                        <i class="far fa-eye me-1"></i> 245 visualizaciones
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <div class="card list-card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <h6 class="card-title mb-0">IA Explicable</h6>
                                        <span class="badge bg-primary">8 fuentes</span>
                                    </div>
                                    <p class="card-text small">
                                        Fuentes sobre transparencia e interpretabilidad en modelos de IA.
                                    </p>
                                    <div class="mt-3">
                                        <span class="badge bg-light text-dark me-1">Ética</span>
                                        <span class="badge bg-light text-dark">IA</span>
                                    </div>
                                </div>
                                <div class="card-footer bg-transparent border-top-0">
                                    <small class="text-muted">
                                        <i class="far fa-eye me-1"></i> 189 visualizaciones
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <div class="card list-card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <h6 class="card-title mb-0">Recomendación Colaborativa</h6>
                                        <span class="badge bg-primary">5 fuentes</span>
                                    </div>
                                    <p class="card-text small">
                                        Artículos clave sobre sistemas de recomendación basados en filtrado colaborativo.
                                    </p>
                                    <div class="mt-3">
                                        <span class="badge bg-light text-dark me-1">Computacionales</span>
                                        <span class="badge bg-light text-dark">Sistemas</span>
                                    </div>
                                </div>
                                <div class="card-footer bg-transparent border-top-0">
                                    <small class="text-muted">
                                        <i class="far fa-eye me-1"></i> 142 visualizaciones
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Script para Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Datos de lectura para el servidor -->
<script id="readingStatsData" type="application/json">
    <%- JSON.stringify(user.readingStats) %>
</script>

<!-- Script para pasar datos del servidor al frontend -->
<script>
    // Leer datos del elemento HTML (evita error de sintaxis)
    const readingStatsElement = document.getElementById('readingStatsData');
    const readingStats = JSON.parse(readingStatsElement.textContent);

    // Configuración para la gráfica de radar
    const radarData = {
        labels: [
            'Ciencias Cognitivas',
            'Ciencias Sociales', 
            'Ciencias Humanistas',
            'Disciplinas Creativas',
            'Ciencias Computacionales',
            'Ciencias Exactas',
            'Ciencias Naturales',
            'Ciencias Aplicadas'
        ],
        datasets: [{
            label: 'Lecturas por categoría',
            data: [
                readingStats.cognitiveSciences,
                readingStats.socialSciences,
                readingStats.humanities,
                readingStats.creativeDisciplines,
                readingStats.computationalSciences,
                readingStats.exactSciences,
                readingStats.naturalSciences,
                readingStats.appliedSciences
            ],
            backgroundColor: 'rgba(183, 147, 76, 0.2)',
            borderColor: 'rgba(183, 147, 76, 1)',
            borderWidth: 2,
            pointBackgroundColor: 'rgba(183, 147, 76, 1)',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: 'rgba(183, 147, 76, 1)',
            pointRadius: 4,
            pointHoverRadius: 6
        }]
    };
    
    const radarConfig = {
        type: 'radar',
        data: radarData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    angleLines: {
                        color: 'rgba(141, 110, 99, 0.3)'
                    },
                    grid: {
                        color: 'rgba(141, 110, 99, 0.1)'
                    },
                    pointLabels: {
                        color: '#3e2723',
                        font: {
                            family: "'Palatino Linotype', 'Book Antiqua', serif",
                            size: 11
                        }
                    },
                    ticks: {
                        backdropColor: 'transparent',
                        color: '#3e2723',
                        font: {
                            family: "'Georgia', 'Times New Roman', serif",
                            size: 10
                        },
                        stepSize: 5
                    },
                    beginAtZero: true,
                    suggestedMin: 0,
                    suggestedMax: 30
                }
            },
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#3e2723',
                        font: {
                            family: "'Palatino Linotype', 'Book Antiqua', serif",
                            size: 12
                        },
                        padding: 20
                    }
                }
            }
        }
    };
</script>

<%- include('partials/footer', { jsFile: 'profile.js' }) %>
<%- include('partials/header', { title: 'Recuperación de Contraseña', currentPage: 'forgot-password', cssFile: 'forgot-password.css', jsFile: 'forgot-password.js' }) %>

<div class="row justify-content-center align-items-center min-vh-75 py-5">
    <div class="col-md-8 col-lg-6">
        <div class="card password-card">
            <div class="password-header text-center">
                <h2 class="mb-3">Recuperación de Contraseña</h2>
                <p class="mb-0">Sigue los pasos para restablecer tu contraseña</p>
            </div>
            <div class="password-body">
                <!-- Paso 1: Identificación -->
                <div id="step1" class="recovery-step active">
                    <div class="text-center mb-4">
                        <div class="password-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <h4 class="mb-2">Identificación de cuenta</h4>
                        <p class="text-muted">
                            Ingresa tu nombre de usuario o correo electrónico asociado a tu cuenta.
                        </p>
                    </div>

                    <form id="identifyForm">
                        <div class="mb-4">
                            <label for="userIdentifier" class="form-label">Usuario o Correo Electrónico</label>
                            <input type="text" class="form-control" id="userIdentifier" 
                                   placeholder="Ej: leonardo.serna o leonardo.serna@ejemplo.com" required>
                        </div>

                        <!-- CAPTCHA -->
                        <div class="mb-4">
                            <div class="captcha-container p-3 border rounded">
                                <div class="row align-items-center">
                                    <div class="col-md-6 text-center mb-3 mb-md-0">
                                        <div class="captcha-display p-3 border bg-light">
                                            <canvas id="captchaCanvas" width="180" height="60"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="captchaInput" 
                                                   placeholder="Ingresa el código" required>
                                            <button class="btn btn-outline-secondary" type="button" id="refreshCaptcha" title="Actualizar código">
                                                <i class="fas fa-redo"></i>
                                            </button>
                                        </div>
                                        <div class="form-text mt-2">
                                            <i class="fas fa-info-circle me-1"></i>
                                            Ingresa los caracteres que ves en la imagen.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane me-2"></i> Enviar Código de Recuperación
                            </button>
                            <a href="/login" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i> Volver al inicio de sesión
                            </a>
                        </div>
                    </form>
                </div>

                <!-- Paso 2: Verificación de código -->
                <div id="step2" class="recovery-step">
                    <div class="text-center mb-4">
                        <div class="password-icon">
                            <i class="fas fa-mail-bulk"></i>
                        </div>
                        <h4 class="mb-2">Verificación de código</h4>
                        <p class="text-muted">
                            Ingresa el código de 6 dígitos enviado a tu correo.
                        </p>
                    </div>

                    <form id="verifyRecoveryForm">
                        <div class="mb-4">
                            <label class="form-label">Código de Recuperación</label>
                            <div class="otp-input-container text-center">
                                <div class="d-flex justify-content-center gap-2 mb-3">
                                    <input type="text" class="form-control recovery-digit text-center" maxlength="1" required>
                                    <input type="text" class="form-control recovery-digit text-center" maxlength="1" required>
                                    <input type="text" class="form-control recovery-digit text-center" maxlength="1" required>
                                    <input type="text" class="form-control recovery-digit text-center" maxlength="1" required>
                                    <input type="text" class="form-control recovery-digit text-center" maxlength="1" required>
                                    <input type="text" class="form-control recovery-digit text-center" maxlength="1" required>
                                </div>
                                <input type="hidden" id="recoveryCode" name="recoveryCode">
                            </div>
                        </div>

                        <div class="mb-4 text-center">
                            <div id="recoveryTimer" class="timer mb-2">
                                El código expira en: <span id="recoveryTimerCount">15:00</span>
                            </div>
                            <button type="button" id="resendRecoveryBtn" class="btn btn-link text-gold">
                                <i class="fas fa-redo me-1"></i> Reenviar código
                            </button>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-check-circle me-2"></i> Verificar Código
                            </button>
                            <button type="button" id="backToStep1" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i> Volver
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Paso 3: Nueva contraseña -->
                <div id="step3" class="recovery-step">
                    <div class="text-center mb-4">
                        <div class="password-icon">
                            <i class="fas fa-key"></i>
                        </div>
                        <h4 class="mb-2">Nueva Contraseña</h4>
                        <p class="text-muted">
                            Crea una nueva contraseña para tu cuenta.
                        </p>
                    </div>

                    <form id="newPasswordForm">
                        <div class="mb-4">
                            <label for="newPassword" class="form-label">Nueva Contraseña</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="newPassword" 
                                       placeholder="Entre 8 y 22 caracteres" required minlength="8" maxlength="22">
                                <button class="btn btn-outline-secondary" type="button" id="toggleNewPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text">Puede incluir letras, números y símbolos.</div>
                        </div>

                        <div class="mb-4">
                            <label for="confirmNewPassword" class="form-label">Confirmar Nueva Contraseña</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="confirmNewPassword" 
                                       placeholder="Repite tu nueva contraseña" required>
                                <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <div class="password-strength mb-4">
                            <div class="progress" style="height: 5px;">
                                <div class="progress-bar" id="passwordStrengthBar" style="width: 0%"></div>
                            </div>
                            <div class="form-text text-end" id="passwordStrengthText">Fortaleza: Débil</div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i> Establecer Nueva Contraseña
                            </button>
                            <button type="button" id="backToStep2" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i> Volver
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <p class="text-muted">
                <i class="fas fa-shield-alt me-1"></i>
                Para mayor seguridad, los enlaces de recuperación expiran después de 15 minutos.
            </p>
        </div>
    </div>
</div>

<%- include('partials/footer') %>